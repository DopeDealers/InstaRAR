name: Deploy PowerShell Scripts to R2

on:
  push:
    branches:
      - main
    paths:
      - 'ir_*.ps1'
  workflow_dispatch: # Allow manual triggering

jobs:
  deploy:
    runs-on: ubuntu-latest
    environment: production # Use your environment name
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      
    - name: Upload ir_hardened.ps1 to R2
      uses: ryand56/r2-upload-action@latest
      with:
        r2-account-id: ${{ secrets.R2_ACCOUNT_ID }}
        r2-access-key-id: ${{ secrets.R2_ACCESS_KEY_ID }}
        r2-secret-access-key: ${{ secrets.R2_SECRET_ACCESS_KEY }}
        r2-bucket: ${{ secrets.R2_BUCKET_NAME }}
        source-dir: 'ir_hardened.ps1'
        destination-dir: 'ir_hardened.ps1'
        output-file-url: true
        
    - name: Upload ir_license.ps1 to R2
      uses: ryand56/r2-upload-action@latest
      with:
        r2-account-id: ${{ secrets.R2_ACCOUNT_ID }}
        r2-access-key-id: ${{ secrets.R2_ACCESS_KEY_ID }}
        r2-secret-access-key: ${{ secrets.R2_SECRET_ACCESS_KEY }}
        r2-bucket: ${{ secrets.R2_BUCKET_NAME }}
        source-dir: 'ir_license.ps1'
        destination-dir: 'ir_license.ps1'
        output-file-url: true
        
    - name: Upload ir_unlicense.ps1 to R2
      uses: ryand56/r2-upload-action@latest
      with:
        r2-account-id: ${{ secrets.R2_ACCOUNT_ID }}
        r2-access-key-id: ${{ secrets.R2_ACCESS_KEY_ID }}
        r2-secret-access-key: ${{ secrets.R2_SECRET_ACCESS_KEY }}
        r2-bucket: ${{ secrets.R2_BUCKET_NAME }}
        source-dir: 'ir_unlicense.ps1'
        destination-dir: 'ir_unlicense.ps1'
        output-file-url: true

    - name: Deployment Summary
      run: |
        echo "‚úÖ Successfully deployed PowerShell scripts to R2:"
        echo "   ‚Ä¢ ir_hardened.ps1 - Enhanced WinRAR installer"
        echo "   ‚Ä¢ ir_license.ps1 - WinRAR licenser"
        echo "   ‚Ä¢ ir_unlicense.ps1 - WinRAR unlicenser"
        echo ""
        echo "üìç Available at: https://cdn.cyci.org/[filename]"
